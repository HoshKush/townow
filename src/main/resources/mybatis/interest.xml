<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="interest">
	<insert id="create" parameterType="InterestDTO">
		insert into interest(ca_id, email, in_priority)
		values(#{ca_id}, #{email}, #{in_priority})
	</insert>
	
	<update id="updatePriority" parameterType="InterestDTO">
		update interest set
		in_priority = #{in_priority},
		create_time = unix_timestamp()
		where in_id = #{in_id}
	</update>
	
	<delete id="delete" parameterType="int">
		delete from interest
		where in_id = #{pk}
	</delete>
	
	<select id="list" parameterType="Map" resultType="InterestDTO">
		select in_id, date_format(create_time), ca_id, in_priority, r 
		from ( select in_id, create_time, ca_id, in_priority, rownum r
		from ( select in_id, create_time, ca_id, in_priority )
		FROM interest
		<where>
			email = #{email}
			<choose>
				<when test="in_priority!=-1">
					and in_priority = #{in_priority}
				</when>
			</choose>
		</where>
		ORDER BY loc_priority DESC, create_time DESC)
		<![CDATA[)where r>=#{sno} and r<=#{eno}]]>
	</select>
	
	<select id="total" parameterType="Map" resultType="int">
		select count(*) from interest
		<where>
			email = #{email}
			<choose>
				<when test="in_priority!=-1">
					and in_priority = #{in_priority}
				</when>
			</choose>
		</where>
	</select>
</mapper>