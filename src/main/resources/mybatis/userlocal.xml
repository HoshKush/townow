<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="userlocal">
	<insert id="create" parameterType="UserlocalDTO">
		insert into userlocal(email, loc_id, ul_priority)
		values(#{email}, #{loc_id}, #{ul_priority})
	</insert>
	
	<update id="updatePriority" parameterType="UserlocalDTO">
		update userlocal set
		ul_priority = #{ul_priority},
		create_time = unix_timestamp()
		where ul_id = #{ul_id}
	</update>
	
	<delete id="delete" parameterType="int">
		delete from userlocal
		where ul_id = #{ul_id}
	</delete>
	
	<select id="list" parameterType="Map" resultType="UserlocalDTO" >
		select ul_id, date_format(create_time), loc_id, ul_priority, r 
		from ( select ul_id, create_time, loc_id, ul_priority, rownum r
		from ( select ul_id, create_time, loc_id, ul_priority )
		FROM userlocal
		<where>
			email = #{email}
			<choose>
				<when test="in_priority!=-1">
					ul_priority = #{ul_priority}
				</when>
			</choose>
		</where>
		ORDER BY ul_priority DESC, create_time DESC)
		<![CDATA[)where r>=#{sno} and r<=#{eno}]]>
	</select>
</mapper>